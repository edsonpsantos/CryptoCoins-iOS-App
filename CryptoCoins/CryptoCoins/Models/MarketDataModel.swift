//
//  MarketDataModel.swift
//  CryptoCoins
//
//  Created by EDSON SANTOS on 23/02/2024.
//


import Foundation

// JSON Data:
/*
 URL:  https://api.coingecko.com/api/v3/global
 JSON Response
 {
   "data": {
     "active_cryptocurrencies": 12868,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 940,
     "total_market_cap": {
       "btc": 40136261.976297975,
       "eth": 698391521.3455989,
       "ltc": 29901654676.03274,
       "bch": 7771180098.066161,
       "bnb": 5484670105.689374,
       "eos": 2638759802380.6675,
       "xrp": 3846523104740.158,
       "xlm": 17828664960804.89,
       "link": 114194902002.69382,
       "dot": 275232074680.6304,
       "yfi": 271024698.86154956,
       "usd": 2049613367296.0425,
       "aed": 7528024936741.647,
       "ars": 1719508842539002.8,
       "aud": 3121317254401.1616,
       "bdt": 224999830680301.38,
       "bhd": 772370152491.737,
       "bmd": 2049613367296.0425,
       "brl": 10204205110420.076,
       "cad": 2767556036819.2354,
       "chf": 1804596436529.3718,
       "clp": 2009707395034786.5,
       "cny": 14751682288439.783,
       "czk": 47987825275586.08,
       "dkk": 14112565699409.443,
       "eur": 1893084394435.6418,
       "gbp": 1617001473860.8652,
       "gel": 5431475423334.515,
       "hkd": 16036359450927.3,
       "huf": 736128513851964.6,
       "idr": 3.1965164899307796e+16,
       "ils": 7440916368631.569,
       "inr": 169873310675931.62,
       "jpy": 308117608900601.4,
       "krw": 2726226069026078.5,
       "kwd": 630750067265.0514,
       "lkr": 637395379064057.5,
       "mmk": 4305011023882485.5,
       "mxn": 35067031863951.227,
       "myr": 9792027862256.828,
       "ngn": 3293728681244740.5,
       "nok": 21581762633282.95,
       "nzd": 3306915893649.92,
       "php": 114519082725682.31,
       "pkr": 573328099166887.2,
       "pln": 8155118493759.436,
       "rub": 194276148850280.66,
       "sar": 7687197910845.849,
       "sek": 21142967056318.62,
       "sgd": 2753190296727.8555,
       "thb": 73671470942384.84,
       "try": 63663594197191.71,
       "twd": 64718181763066.33,
       "uah": 78465617039545.6,
       "vef": 205227786467.3525,
       "vnd": 5.0501753043804744e+16,
       "zar": 39485746181397.32,
       "xdr": 1547523679936.2656,
       "xag": 89251582358.52553,
       "xau": 1005130395.3219771,
       "bits": 40136261976297.98,
       "sats": 4013626197629797.5
     },
     "total_volume": {
       "btc": 1721642.769367441,
       "eth": 29957466.23395646,
       "ltc": 1282629847.181953,
       "bch": 333344346.6456519,
       "bnb": 235264625.17615908,
       "eos": 113189457866.0303,
       "xrp": 164996398877.19098,
       "xlm": 764759611529.6124,
       "link": 4898384095.849856,
       "dot": 11806064838.61737,
       "yfi": 11625589.682231119,
       "usd": 87918053651.5314,
       "aed": 322914219256.7102,
       "ars": 73758238058364.06,
       "aud": 133888733462.89766,
       "bdt": 9651355470731.082,
       "bhd": 33130775583.882065,
       "bmd": 87918053651.5314,
       "brl": 437708821909.51416,
       "cad": 118714165320.69714,
       "chf": 77408065763.86638,
       "clp": 86206289146936.0,
       "cny": 632772607546.1659,
       "czk": 2058435149047.2627,
       "dkk": 605357736302.385,
       "eur": 81203751894.16386,
       "gbp": 69361190067.3026,
       "gel": 232982842176.5583,
       "hkd": 687878764394.4106,
       "huf": 31576192470211.97,
       "idr": 1371144005713090.2,
       "ils": 319177701976.52026,
       "inr": 7286706400472.379,
       "jpy": 13216688036164.598,
       "krw": 116941318605392.72,
       "kwd": 27055989748.77592,
       "lkr": 27341040036112.277,
       "mmk": 184663213173446.44,
       "mxn": 1504198420057.2,
       "myr": 420028501320.19055,
       "ngn": 141284312218010.97,
       "nok": 925748531583.1886,
       "nzd": 141849976975.20477,
       "php": 4912289810289.109,
       "pkr": 24592877557674.695,
       "pln": 349813363197.7715,
       "rub": 8333464813593.214,
       "sar": 329741935303.2877,
       "sek": 906926419231.0923,
       "sgd": 118097947682.65346,
       "thb": 3160133729731.034,
       "try": 2730846402344.7095,
       "twd": 2776082878490.0225,
       "uah": 3365778365206.6084,
       "vef": 8803234712.127829,
       "vnd": 2166269943613373.2,
       "zar": 1693738929809.3027,
       "xdr": 66380943884.62306,
       "xag": 3828441759.546516,
       "xau": 43115013.5107109,
       "bits": 1721642769367.4412,
       "sats": 172164276936744.1
     },
     "market_cap_percentage": {
       "btc": 48.92257532999869,
       "eth": 17.208000176248355,
       "usdt": 4.776287811346134,
       "bnb": 2.8093462858691773,
       "sol": 2.1609939692337132,
       "xrp": 1.4183613917150368,
       "steth": 1.4024689500337666,
       "usdc": 1.3694013691741513,
       "ada": 0.9932889297033346,
       "avax": 0.6622919885668348
     },
     "market_cap_change_percentage_24h_usd": -0.7228110569082568,
     "updated_at": 1708708006
   }
 }
*/

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
   
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {

        if let item = totalMarketCap.first(where: {$0.key == "usd"}){
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }){
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: {$0.key == "btc"}){
            return item.value.asPercentString()
        }
        return ""
    }
}

